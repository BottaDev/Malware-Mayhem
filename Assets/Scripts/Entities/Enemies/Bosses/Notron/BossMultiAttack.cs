using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class BossMultiAttack : SubmoduleAttack
{
    [Header("Pattern Parameters")]
    [SerializeField] private string patternName;
    
    [Space]
    [Space]
    
    [SerializeField] private Transform shotSpawn;
    [SerializeField] private float initialDelay;
    [Header("Projectile Parameters")]
    [SerializeField] private float fireRate = 1f;
    [SerializeField, Range(0f, 10f)] private float bulletCount = 3;
    [SerializeField] private GenericAttackPhase.BossBulletType projectile = GenericAttackPhase.BossBulletType.MediumGreen;

    private NotronMobilizer _mobilizer;
    
    protected override void Start()
    {
        base.Start();
        _mobilizer = GetComponentInParent<NotronMobilizer>();
    }
    
    public override void MakeAction()
    {
        base.MakeAction();
        StartShooting();
    }
    
    private void StartShooting()
    {
        if (this == null || 
            !gameObject.activeInHierarchy) 
            return;
        
        StartCoroutine(SpawnShoot());
    }
    
    private IEnumerator SpawnShoot()
    {
        yield return new WaitForSeconds(initialDelay);

        _mobilizer.StopMovement();
        
        for (var i = 0; i < bulletCount; i++)
        {
            // Break the loop if the boss is stunned
            if (_submodule.GetIsStunned())
                yield return null;

            var position = shotSpawn.position;
            
            var bullet = EnemyPoolManager.Instance.GetBossBullet(projectile);
            bullet.transform.position = position;
            bullet.transform.eulerAngles = shotSpawn.transform.eulerAngles;
            
            //AudioManager.Instance.PlayAudioClip(Sounds.SoundType.EnemyBlueShot, position);

            yield return new WaitForSeconds(fireRate);
        }
        
        _mobilizer.RestartMovement();
    }
}
