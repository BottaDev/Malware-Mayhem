using EZCameraShake;
using UnityEngine;

public class ShieldArm : AttackArm
{
    [Header("ShieldArm Parameters")]
    [SerializeField]private GameObject shield;
    
    private bool _isShieldActive = true;
    
    public override void MakeAction()
    {
        if (_currentFireRate <= 0 && gameObject.activeSelf)
            Shoot();
    }

    private void Shoot()
    {
        var bullet = _controller.shieldBulletPool.Get();
        bullet.pool = _controller.shieldBulletPool;
        bullet.transform.position = shotSpawn.position;
        bullet.transform.eulerAngles = transform.eulerAngles;

        _isShieldActive = false;
        SetShield();
        
        SubtractTime(useDurationLoss);
        
        CameraShaker.Instance.ShakeOnce(magnitude, roughness, fadeIn, fadeOut);

        _currentFireRate = fireRate;

        _isShieldActive = true;
        Invoke(nameof(SetShield), fireRate/2);
    }

    private void SetShield()
    {
        shield.SetActive(_isShieldActive);
    }
}
