using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Random = UnityEngine.Random;

public class RandomMissilesAttack : SubmoduleAttack
{
    [Header("Attack Parameters")]
    [SerializeField] private float missileCount = 6f;
    [SerializeField] private float timeBetweenMissiles = 0.5f;
    [SerializeField] private GameObject missile;

    [Header("Area Parameters")]
    [SerializeField, Range(1f, 20f)] private float xDim = 12f;
    [SerializeField, Range(1f, 20f)] private float zDim = 12f;

    public override void MakeAction()
    {
        StartCoroutine(SpawnMissiles());
    }

    private IEnumerator SpawnMissiles()
    {
        for (var i = 0; i < missileCount; i++)
        {
            var xRand =  Random.Range(-xDim, xDim);
            var zRand =  Random.Range(-zDim, zDim);
            
            // Fix the Y of the spawn
            const float yAxis = 1f;

            var position = transform.position;
            var pos = new Vector3 (position.x - xRand, yAxis, position.z - zRand);

            Instantiate(missile, pos, Quaternion.identity);

            yield return new WaitForSeconds(timeBetweenMissiles);
        }
    }

    private void OnDrawGizmosSelected()
    {
        Gizmos.color = Color.red;
        Gizmos.DrawWireCube(transform.parent.transform.position, new Vector3(xDim * 2, 0, xDim * 2));
        Gizmos.DrawWireCube(transform.parent.transform.position, new Vector3(zDim * 2, 0, zDim * 2));
    }
}
