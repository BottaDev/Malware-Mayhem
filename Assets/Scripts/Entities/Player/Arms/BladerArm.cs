using System.Collections;
using MM.Sound;
using UnityEngine;

namespace MM.Entities.Player.Arms
{
    public class BladerArm : PlayerArm
    {
        #region Private Variables
        [SerializeField] private GameObject cone;
        [SerializeField] private float attackDuration = 0.5f;
        #endregion

        #region Events
        private void OnEnable()
        {
            cone.SetActive(false);
        }
        #endregion

        #region Public Functions
        public override void MakeAction()
        {
            if(!enabled) 
                return;
        
            if (_currentFireRate <= 0)
                Attack();
        }
        #endregion

        #region Private Functions
        private void Attack()
        {
            AudioManager.Instance.PlayAudioClip(Sounds.SoundType.SwordAttack, transform.position);
            StartCoroutine(nameof(MakeAttack));
            _currentFireRate = fireRate;
        }
    
        private IEnumerator MakeAttack()
        {
            cone.SetActive(true);
            SubtractEnergy();

            _cameraShaker.ShakeCamera();

            if (!gameObject.activeInHierarchy)
                yield break;
        
            yield return new WaitForSeconds(attackDuration);
        
            cone.SetActive(false);
        }
        #endregion
    }
}
