using UnityEngine;

public class WorldMapLevelPoint : MonoBehaviour
{
    [SerializeField] private int level = 1;
    [Header("UI")]
    [SerializeField] private RectTransform levelIndicator; 
    
    private LineRenderer _lineRenderer;
    private Camera _cam;

    private void Awake()
    {
        _lineRenderer = GetComponentInChildren<LineRenderer>();
    }

    private void Start()
    {
        _cam = Camera.main;
    }

    private void SetPositions()
    {
        if (!_lineRenderer.enabled)
            _lineRenderer.enabled = true;
        
        _lineRenderer.positionCount = 2;

        var screenPosition = RectTransformUtility.WorldToScreenPoint(_cam, levelIndicator.position);
        var worldPosition = _cam.ScreenToWorldPoint(new Vector3(screenPosition.x, screenPosition.y, _cam.nearClipPlane));
        
        _lineRenderer.SetPosition(0, _lineRenderer.transform.position);
        _lineRenderer.SetPosition(1, worldPosition);

    }

    private void UpdateLineRenderer()
    {
        // Check if window "--LEVELS--" in canvas is active
        var levelsWindowsDisable = !levelIndicator.transform.parent.parent.parent.transform.gameObject.activeSelf;
        
        // Check if level section in canvas is active
        var levelSectionDisable = !levelIndicator.transform.parent.parent.transform.gameObject.activeSelf; 
        
        if (levelsWindowsDisable || levelSectionDisable)
        {
            _lineRenderer.enabled = false;
            return;   
        }

        SetPositions();
    }
    
    private void Update()
    {
        UpdateLineRenderer();
    }
    
    private void OnMouseDown()
    {
        MenuUIManager.Instance.ShowLevel(level);
    }
}
