using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class UIManager : MonoBehaviour
{
    public static UIManager Instance = null;
    
    [Header("HUD")]
    public UIHealthBar healthBar;
    public List<UIBar> leftBars = new List<UIBar>();
    public List<UIBar> rightBars = new List<UIBar>();

    [Header("Pause Menu")] 
    public GameObject hud;
    public GameObject pauseMenu;
    
    [Header("Fade")] 
    public GameObject fadeIn;

    [SerializeField] private GameObject absorbMenu;
    
    private UIBar _currentLeftUIBar;
    private UIBar _currentRightUIBar;
    private List<GameObject> _screens;

    private const float _maxArmValue = 20f;

    private void Awake()
    {
        if (Instance == null)
            Instance = this;
        
        InitializeArmBars();
        
        _currentLeftUIBar = leftBars[0];
        _currentRightUIBar = rightBars[0];
        
        _screens = new List<GameObject>
        {
            hud,
            pauseMenu
        };
    }

    public void Resume()
    {
        LevelManager.Instance.ResumeLevel();
    }

    public void ResumeLevel()
    {
        ShowScreen(hud);
    }

    public void ExitLevel()
    {
        LevelManager.Instance.RestartLevelSpeed();
        SceneLoader.Instance.MainMenu();
    }
    
    public void RestartLevel()
    {
        LevelManager.Instance.RestartLevelSpeed();
        SceneLoader.Instance.RetryLevel();
    }

    public void PauseLevel()
    {
        ShowScreen(pauseMenu);
    }
    
    private void ShowScreen(GameObject screen)
    {
        foreach (var s in _screens)
        {
            s.SetActive(false);
        }
        
        screen.SetActive(true);
    }
    
    private void InitializeArmBars()
    {
        foreach (var bar in leftBars)
        {
            bar.SetMaxValue(_maxArmValue);
        }
        
        foreach (var bar in rightBars)
        {
            bar.SetMaxValue(_maxArmValue);
        }
    }

    public void SetArmDuration(bool isLeft, float value)
    {
        // Should ignore when is the basic arm
        switch (isLeft)
        {
            case true when _currentLeftUIBar != leftBars[0]:
                _currentLeftUIBar.SetValue(value);
                break;
            case false when _currentRightUIBar != rightBars[0]:
                _currentRightUIBar.SetValue(value);
                break;
        }
    }
    
    public void SetArmBar(bool isLeft, int index)
    {
        var bars = isLeft ? leftBars : rightBars; 
        
        foreach (var bar in bars)
        {
            bar.gameObject.SetActive(false);
        }
        
        bars[index].gameObject.SetActive(true);

        if (isLeft)
            _currentLeftUIBar = bars[index];
        else
            _currentRightUIBar = bars[index];
        
        bars[index].SetValue(_maxArmValue);
    }
    
    public void SetHealth(float newHealth, bool takingDamage)
    {
        healthBar.SetValue(newHealth);

        StartCoroutine(takingDamage ? 
            healthBar.BlinkBar(Color.red) : 
            healthBar.BlinkBar(Color.green));
    }

    public void SetMaxHealth(float newHealth)
    {
        healthBar.SetMaxValue(newHealth);
    }

    public void StartFadeIn()
    {
        ShowScreen(fadeIn);
    }

    public void ToggleAbsorbMenu(bool active)
    {
        absorbMenu.SetActive(active);
    }
}