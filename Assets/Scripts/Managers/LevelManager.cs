using UnityEngine;
using UnityEngine.SceneManagement;

public class LevelManager : MonoBehaviour
{
    public static LevelManager Instance = null;

    public GameObject spawnPosition;
    public GameObject playerSpawn;

    private bool _isLoadingScene;
    private PlayerModel _player;
    
    private void Awake()
    {
        if (Instance == null)
            Instance = this;

        if (playerSpawn != null && spawnPosition != null)
            Instantiate(playerSpawn, spawnPosition.transform.position, Quaternion.identity, transform);
    }

    private void Start()
    {
        EventManager.Instance.Subscribe("OnPlayerSpawned", OnPlayerSpawned);
        
        AudioManager.Instance.Stop("MainMenu");
        AudioManager.Instance.Play("Level 1-1");
    }

    public void EndLevel()
    {
        _isLoadingScene = true;
        UIManager.Instance.StartFadeIn();
        
        AudioManager.Instance.Stop("Level 1-1");
        AudioManager.Instance.Stop("TresholdLife");
        AudioManager.Instance.Play("LoseLevel");
        Invoke(nameof(ShowLoseScene), 2f);
    }

    public PlayerModel GetPlayer()
    {
        return _player;
    }
    
    private void ShowLoseScene()
    {
        SceneManager.LoadScene("LoseScene");
    }
    
    private void OnPlayerSpawned(params object[] parameters)
    {
        _player = (PlayerModel) parameters[1];
    }
}
