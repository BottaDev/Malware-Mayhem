using UnityEngine;
using Cinemachine;

public class CameraShakeManager : MonoBehaviour
{
    public static CameraShakeManager Instance;
    
    private CinemachineVirtualCamera _virtualCamera;
    private CinemachineBasicMultiChannelPerlin _perlin;
    
    private float _shakeTimer;
    private float _shakeTimerTotal;
    private float _startingIntensity;
    
    private void Awake()
    {
        if (Instance == null)
            Instance = this;

        _virtualCamera = GetComponent<CinemachineVirtualCamera>();
        _perlin = _virtualCamera.GetCinemachineComponent<CinemachineBasicMultiChannelPerlin>();
    }

    private void OnEnable()
    {
        Instance = this;
    }

    /// <summary>
    /// Shake the camera setting the values of the shake
    /// </summary>
    /// <param name="intensity"></param>
    /// <param name="time"></param>
    public void ShakeCamera(float intensity, float time)
    {
        _perlin.m_AmplitudeGain = intensity;
        _startingIntensity = intensity;
            
        _shakeTimerTotal = time;
        _shakeTimer = time;
    }
    
    private void Update()
    {
        LerpShake();
    }

    private void LerpShake()
    {
        if (_shakeTimer <= 0)
            return;
        
        // Lerp the camera using the delta time
        _shakeTimer -= Time.deltaTime;
        _perlin.m_AmplitudeGain = Mathf.Lerp(_startingIntensity, 0f, 1 - (_shakeTimer/ _shakeTimerTotal));
    }
}
