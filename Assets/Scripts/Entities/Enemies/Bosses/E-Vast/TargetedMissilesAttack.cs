using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TargetedMissilesAttack : SubmoduleAttack
{
    [Header("Attack Parameters")]
    [SerializeField] private float missileCount = 12f;
    [SerializeField] private float timeBetweenMissiles = 0.5f;
    [SerializeField] private GameObject missile;
    
    private PlayerModel _player;
    
    public override void MakeAction()
    {
        StartCoroutine(SpawnMissiles());
    }

    private IEnumerator SpawnMissiles()
    {
        for (var i = 0; i < missileCount; i++)
        {
            if (CheckPlayer())
                continue;
            
            // Fix the Y of the spawn
            const float yAxis = 1f;

            var t = _player.transform;
            var position = t.position;
            var pos = new Vector3 (position.x, yAxis, position.z);

            Instantiate(missile, pos, Quaternion.identity);
            
            yield return new WaitForSeconds(timeBetweenMissiles);
        }
    }

    /// <summary>
    /// Check if the player exists in the level
    /// </summary>
    /// <returns></returns>
    private bool CheckPlayer()
    {
        if (_player == null)
        {
            _player = GameObject.Find("Player")?.GetComponent<PlayerModel>();
            if (_player == null)
                _player = GameObject.Find("Player(Clone)")?.GetComponent<PlayerModel>();
        }

        return _player == null;
    }
}
