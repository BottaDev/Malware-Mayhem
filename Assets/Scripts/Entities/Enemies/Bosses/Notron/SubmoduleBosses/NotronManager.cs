using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using MM.Events;

public class NotronManager : MonoBehaviour
{
    [SerializeField] private float timeToSetShield;
    [SerializeField] private List<CannonSubModules> cannons = new();
    private LaserGenerator _laserGenerator;

    private void Awake()
    {
        _laserGenerator = GetComponentInChildren<LaserGenerator>();
    }

    private void Start()
    {
        StartCoroutine(SetShield());
    }

    private IEnumerator SetShield()
    {
        yield return new WaitForSeconds(timeToSetShield);
        _laserGenerator.SetShield(true);
    }

    public void CannonDestroyed()
    {
        Invoke("CheckCannons", 1f);
    }

    private void CheckCannons()
    {
        for (var i = 0; i < cannons.Count; i++)
        {
            if(cannons[i] == null)
                cannons.RemoveAt(i);
        }
        
        if (cannons.Count == 0)
            _laserGenerator.SetShield(false);
    }
    
    public void LaserDestroyed(int submoduleIndex)
    {
        EventManager.Instance.Trigger(NameEvent.OnReturnedBoss, true, submoduleIndex);
    }
}
