using System.Linq;
using UnityEngine;

public class AudioManager : MonoBehaviour
{
    public static AudioManager Instance = null;
    
    [SerializeField] private AudioClip[] backgroundMusic;
    [SerializeField] private Sounds[] sounds;

    private void Awake()
    {
        if (Instance == null)
            Instance = this;
        else
            Destroy(gameObject);
        
        DontDestroyOnLoad(this);
    }

    /// <summary>
    /// Play a random sound of the specified type at a
    /// random pitch in the specified position
    /// </summary>
    /// <param name="type"></param>
    /// <param name="position"></param>
    public void PlayAudioClip(Sounds.SoundType type, Vector3 position)
    {
        // Get all the sounds of the type
        var soundOfType = sounds.FirstOrDefault(s => s.GetSoundType() == type);

        if (soundOfType == null)
        {
            Debug.LogError($"Sound of type '{type}' not found");
            return;   
        }

        // Get a random sound from the array
        var sound = soundOfType.GetRandomSound();

        if (sound.GetSoundClip() == null)
        {
            Debug.LogError($"Sound Clip of type '{type}' not found");
            return;   
        }

        var soundSource = SoundPoolManager.Instance.soundSourcePool.Get();
        soundSource.pool = SoundPoolManager.Instance.soundSourcePool;
        
        StartCoroutine(soundSource.PlaySound(sound.GetSoundClip(), sound.GetMinPitch(), sound.GetMaxPitch(), position));
    }

    public void PlayMusic(string themeName)
    {
        var theme = backgroundMusic.FirstOrDefault(t => t.name == themeName);
    }
    
    public void StopMusic(string themeName)
    {
        
    }
}