using UnityEngine;
using System.Collections;
using MM.Sound;

public class BladerArm : PlayerArm
{
    [SerializeField] private GameObject cone;
    [SerializeField] private float attackDuration = 0.5f;

    private void OnEnable()
    {
        cone.SetActive(false);
    }

    public override void MakeAction()
    {
        if(!enabled) 
            return;
        
        if (_currentFireRate <= 0)
            Attack();
    }

    private void Attack()
    {
        AudioManager.Instance.PlayAudioClip(Sounds.SoundType.SwordAttack, transform.position);
        StartCoroutine(nameof(MakeAttack));
        _currentFireRate = fireRate;
    }
    
    private IEnumerator MakeAttack()
    {
        cone.SetActive(true);
        SubtractEnergy();

        _cameraShaker.ShakeCamera();

        if (!gameObject.activeInHierarchy)
            yield break;
        
        yield return new WaitForSeconds(attackDuration);
        
        cone.SetActive(false);
    }
}
