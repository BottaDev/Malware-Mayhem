using System.Collections;
using MM.Events;
using UnityEngine;

public class MissileHoles : MonoBehaviour
{
    [SerializeField] private int index;
    [SerializeField] private GameObject[] gates;
    
    private void Start()
    {
        EventManager.Instance.Subscribe(NameEvent.OnMissileBossMoved, OnMissileBossMove);
    }

    private void OnMissileBossMove(params object[] parameters)
    {
        if(index != (int) parameters[1] + 1)
            return;

        StartCoroutine(MoveGate((bool)parameters[0]));
    }

    private IEnumerator MoveGate(bool open)
    {
        for (var i = 0; i < 40; i++)
        {
            if (open)
            {
                gates[0].transform.position -= gates[0].transform.right * .1f;
                gates[1].transform.position += gates[1].transform.right * .1f;
            }
            else
            {
                gates[1].transform.position -= gates[1].transform.right * .1f;
                gates[0].transform.position += gates[0].transform.right * .1f;
            }
            yield return new WaitForSeconds(.01F);
        }
    }
}