using UnityEngine;
using System.Collections;
using EZCameraShake;
using Unity.VisualScripting;

public class BladerArm : PlayerArm
{
    [SerializeField] private GameObject cone;
    [SerializeField] private float attackDuration = 0.5f;

    private void OnEnable()
    {
        cone.SetActive(false);
    }

    public override void MakeAction()
    {
        if(!enabled) 
            return;
        
        if (_currentFireRate <= 0)
            Attack();
    }

    private void Attack()
    {
        StartCoroutine(nameof(MakeAttack));
        _currentFireRate = fireRate;
    }
    
    private IEnumerator MakeAttack()
    {
        cone.SetActive(true);
        SubtractEnergy();

        // ToDo: Check why is null after killing one SubBoss
        if (_cameraShaker != null)
            _cameraShaker.ShakeOnce(magnitude, roughness, fadeIn, fadeOut);

        if (!gameObject.activeInHierarchy)
            yield break;
        
        yield return new WaitForSeconds(attackDuration);
        
        cone.SetActive(false);
    }
}
