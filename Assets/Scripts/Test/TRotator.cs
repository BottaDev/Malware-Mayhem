using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TRotator : MonoBehaviour
{
    public float minRotation = -15;
    public float maxRotation = 160;
    public bool isLeft;
    
    public Transform parentTransform;

    private Vector3 _lockedPosition;
    private bool _locked;
    private RaycastHit _ray;

    private void FixedUpdate()
    {
        Physics.Raycast(Camera.main.ScreenPointToRay(Input.mousePosition), out _ray);
        
        ProcessLock();
        Rotate();
    }
    
    private void ProcessLock()
    {
        bool mousePressed = isLeft ? Input.GetMouseButton(0) : Input.GetMouseButton(1);

        if (Input.GetKey(KeyCode.LeftControl) && mousePressed)
        {
            _locked = true;
            _lockedPosition = InputManager.Instance.mousePosition;   
        }
        
        if (Input.GetKey(KeyCode.LeftAlt))
            _locked = false;
    }

    private void Rotate()
    {
        Vector3 point = _locked ? _lockedPosition : InputManager.Instance.mousePosition;
        
        float angle = Vector3.SignedAngle(point - transform.position, parentTransform.forward, Vector3.up); 
        angle *= isLeft ? 1 : -1;
        
        if(angle >= minRotation && angle <= maxRotation)
            transform.forward = new Vector3(point.x, transform.position.y, point.z) - 
                                new Vector3(parentTransform.position.x, transform.position.y, parentTransform.position.z);
    }
}
